<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%- title %></title>
    <link rel="stylesheet" href="/css/style.css">
    <!-- BS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">


</head>
<body>
    
        <main class="global-container">


            <div class="row" style="flex: 1;">

                <div class="col-2 sidebar">

                    <div class="mt-5 text-center">
                        <h5>
                            
                            <a href="<%=link%>/admin">
                                Naxxt Admin Panel
                            </a>
               

                        </h5>
                    </div>
           

                    <div class="mt-4 text-justify">
                        
                        <div class="d-flex justify-space-around align-items-center">

                            <h5 class="m-0 ps-3">Games</h5>

                            <div class="ms-auto">
                                <a clas href="<%=link%>/admin/resource/create/new/item">+</a>
                            </div>
                      
                        </div>
            
                        <hr>

                        <ul>
                                <% data.games?.forEach(game => { %>
                                
                                    <li>
                                        <a href="<%=link%>/admin/resource/get/<%= game.id %>?data=raw">
                                            <%= game.name %>
                                        </a>
                                    </li>

                                <% }) %>
                        </ul>

                    </div>


                    <div class="mt-4 text-justify">
                        
                        <div class="d-flex justify-space-around align-items-center">

                            <h5 class="m-0 ps-3">Sessions</h5>

                            <div class="ms-auto">
                                <a onclick="generateSampleSession()" href="javascript:void(0)">+</a>
                            </div>
                      
                        </div>
            
                        <hr>

                    </div>
                    
                </div>


                <div class="col-10 p-5 ps-5 ">
                    <%- body %>
                </div>

            </div>

        </main>

        <footer class="bg-dark text-light p-3 text-center">

            &copy; Naxxt
        </footer>

        <!-- BS SCRIPT -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
        <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
        <script>
          
        const socket = io("http://localhost:3000/",{

                        withCredentials: true,

                        auth: {

                            id: "37ad0243-a260-4d88-832f-759d4751b17e"
                        },
                        reconnectionDelay: 5000,
                        reconnectionAttempts: 2
        });
            

        socket.on("userData", data => {

            console.log("received:", data)
        })


        /*
        const payload = { entryId: "66a79232b995f2deed230493"}
        socket.emit("collect", payload, (response) => {

            console.log("received in collect:", response)
        })

        */
       let current_limit = 1

       async function generateSampleSession() {

            try {
                
            const randomPlayerId = Math.floor(Math.random() * 2323131).toString()
            const request = await fetch(`<%=link%>/api/v1/auth/create-session`, {

                method: "POST",
                headers: {
                    "Content-type": "application/json",
                    "auth": "myheader"
                },

                body: JSON.stringify({

                    bank: "Stage",
                    currency: "EUR",
                    id: randomPlayerId,
                    nickname: "Some nickname",
                    externaltoken: "somerandomtoken",
                    gameid: "oceantale_gt_html",
                    name: "Ocean Tale"

                })
            })

            const response = await request.json()

            console.log("Resp:", response)
            if (request.status === 201) {

                alert(`Generated new session: ${response.sessionId}`)
            } 

            } catch (error) {
                
                console.log("[GENERATE SESSION]", error)
                alert("Something went wrong while creating new session.")

            }

        }

        </script>
    </body>
</html>